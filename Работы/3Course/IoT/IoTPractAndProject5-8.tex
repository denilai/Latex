\documentclass[a4paper,14pt]{extarticle}

\newcommand{\stend}{\textbf{Wb-demo-kit v.2}}

% Путь до папки с общими шаблонами
\newcommand{\pathToCommonFolder}{/home/denilai/Documents/repos/latex/Common}
\newcommand{\pathToScriptsFolder}{/home/denilai/Documents/repos/latex/scripts}
% Название работы в титуле
\newcommand{\workname}{Отчет по практическим работам 5-8}
% Название дисциплины в титуле
\newcommand{\discipline}{Технологические основы Инетернета вещей}
% Название кафедры в титуле
\newcommand{\kafedra}{Кафедра Математического обеспечения и стандартизации информационных технологий}
% Тема работы в титуле
\newcommand{\theme}{Знакомство с оборудованием}
% Должность преподавателя в титуле
\newcommand{\rang}{ассистент}

% ФИО студента в титуле
\newcommand{\studentfio}{К.~Ю.~Денисов}%\\Д.~Н.~Федосеев\\А.~М.~Сосунов}\\%К.~Ю.~Денисов\\%И.~А.~Кремнев
% ФИО преподавателя в титуле
\newcommand{\teacherfio}{Ю.~А.~Воронцов}


\usepackage{tabularx}


\usepackage{booktabs}
\newcolumntype{b}{X}
\newcolumntype{s}{>{\hsize=.5\hsize}X}
\newcommand{\heading}[1]{\multicolumn{1}{c}{#1}}

% установка размера шрифта для всего документа
%\fontsize{20pt}{18pt}\selectfont
\usepackage{extsizes} % Возможность сделать 14-й шрифт

% Вставка заготовки преамбулы
\input{\pathToCommonFolder/ruspreamble}

\author{Кирилл Денисов}
\title{Лабораторная работа №1}
\date{\today}

\renewcommand{\withouttheme}{1}

%если нужна тема работы в отчете, то указать в скобках что-либо, иначе оаставить пустым
%\renewcommand{\withouttheme}{}
%если нужна дата представления отчета, то указать в скобках что-либо
%\renewcommand{\withoutsubmissiondate}{1}

% установка полуторного интервала
% \usepackage{setspace}  
% \onehalfspacing

% использовать Times New Roman
\renewcommand{\rmdefault}{ftm}


\begin{document}
	\thispagestyle{empty}
	% Вставка первого титульного листа
	% Есть две версии титульного листа - одиночный (titul) и групповой (titulAll)
	\input{\pathToCommonFolder/iot-titulAll}
	\newpage
	\tableofcontents
	\newpage
	%\listoftables

\normalsize

\section{Практическая работа №5.\\Измерительные и исполнительные устройства в Интернете вещей}

\subsection {Измерительные \\и исполнительные устройства стенда}
Работа на практических занятиях проводится с использованием стенда (чемодана\textbf{ WBdemo-kit v.2}), содержащего типовой набор оборудования в <<умном доме>>.

Стенд состоит из компонентов, расположение которых можно увидеть на Рис. \ref{fig:wb-demo-kit1}-\ref{fig:wb-demo-kit2}. В таблице \ref{tab:device-list} приводится их полный список.
 
% TODO: \usepackage{graphicx} required
\begin{figure}[htpb]
	\centering
	\includegraphics[width=0.6\linewidth]{images/wb-demo-kit1}
	\caption{Компоненты, расположенные на верхней крышке WB-demo-kit}
	\label{fig:wb-demo-kit1}
\end{figure}
 
 % TODO: \usepackage{graphicx} required
 \begin{figure}[htpb]
 	\centering
 	\includegraphics[width=0.6\linewidth]{images/wb-demo-kit2}
 	\caption{Компоненты, расположенные на нижней крышке WB-demo-kit}
 	\label{fig:wb-demo-kit2}
 \end{figure}

\begin{center}
	\begin{table}[htbp]
	%\small
	\begin{tabular}{|r|p{0.8\linewidth}|}
		\hline
		\multicolumn{1}{|c|}{\textbf{Номер}} & \multicolumn{1}{c|}{\textbf{Название}} \\ \hline\hline
		1 & Датчик температуры 1-wire DS18B20 \\ \hline
		2 & Датчик температуры 1-wire DS18B20 \\ \hline
		4 & Устройство ИК-управления WB-MIR \\ \hline
		5 & Настенный комбинированный датчик WB-MSW v.3 \\ \hline
		10 & Модуль обнаружения протечек WB-MWAC \\ \hline
		11 & Диммер светодиодных лент на DIN-рейку WB-MRGBW-D \\ \hline
		12 & Комбинированный датчик WB-MS \\ \hline
		21 & Модуль реле 3-канальный WB-MR3 \\ \hline
		22 & Многоканальный измеритель WB-MAP12H \\ \hline
		23 & Датчик протечки \\ \hline
	\end{tabular}
    \caption{Список датчиков и исполнительных устройств демонстрационного набора WB-demo-kit}
	\label{tab:device-list}
\end{table}
\end{center}	
%\subsection*{Индивидуальный вариант №5}

\begin{problem}
	Опишите следующие датчики и исполнительные устройства:
	
	\begin{enumerate}
		\item Освещенность в составе датчика WB-MSW v.3 (5)
		\item Влажность в составе датчика WB-MS v.2 (12)
		\item Преобразователь 1-Wire — Modbus RTU WB-M1W2 (3)
	\end{enumerate}
	\nonum
	Опишем устройства в отдельности
	\subsubsection*{Освещенность в составе датчика WB-MSW v.3 (5)}
	
	\begin{enumerate}
		\item \textbf{Название датчика/устройства:} датчик освещения в составе WB-MSW v.3
		
		\item \textbf{Тип измерения:} цифровой
		
		\item  \textbf{Измеряемые параметры и диапазон измерения:} Освещённость; 0,02~--~100 000 лк
		
		\item  \textbf{Точность:} $\pm10 \%$	
		\item  \textbf{Напряжение питания:} 9 В~--~28 В постоянного тока
		
		\item  \textbf{Уникальный идентификатор датчика в веб-интерфейсе:} \\wb-msw-v3\_21/Illuminance
		
		\item  \textbf{Использующийся протокол передачи данных:} Modbus RTU
		
		\item  \textbf{Интерфейс управления (шина):} RS-485
		
		\item  \textbf{Описание входов и выходов, схема подключения:} см. рис. \ref{fig:device-1}.
	\end{enumerate}
	
	
	\subsubsection*{Влажность в составе датчика WB-MS v.2 (12)}
	\begin{enumerate}
		\item \textbf{Название датчика/устройства:} датчик влажности в составе WB-MS v.2
		
		\item \textbf{Тип измерения:} цифровой
		
		\item  \textbf{Измеряемые параметры и диапазон измерения:} влажность; 0~–~98~\%
		
		\item  \textbf{Точность:} $\pm3 \%$	
		\item  \textbf{Напряжение питания:} 9 В~--~28 В постоянного тока
		
		\item  \textbf{Уникальный идентификатор датчика в веб-интерфейсе:} \\wb-ms\_11/Humidity
		
		\item  \textbf{Использующийся протокол передачи данных:} Modbus RTU
		
		\item  \textbf{Интерфейс управления (шина):} RS-485
		
		\item  \textbf{Описание входов и выходов, схема подключения:} см. рис. \ref{fig:device-2}.
		
	\end{enumerate}
	
	\subsubsection*{Преобразователь 1-Wire~--~Modbus RTU WB-M1W2}
	\begin{enumerate}
		\item \textbf{Название датчика/устройства:} компактный преобразователь2
		
		\item \textbf{Тип измерения:} цифровой
		
		\item  \textbf{Напряжение питания:} 9 В~--~28 В постоянного тока
		
		\item  \textbf{Уникальный идентификатор датчика в веб-интерфейсе:}\\ wb-m1w2\_14
		
		\item  \textbf{Использующийся протокол передачи данных:} Modbus RTU
		
		\item  \textbf{Интерфейс управления (шина):} RS-485
		
		\item  \textbf{Описание входов и выходов, схема подключения:} см. рис. \ref{fig:device-3}.
		
	\end{enumerate}
	
	% TODO: \usepackage{graphicx} required
	\begin{figure}[h!]
		\centering
		\includegraphics[width=0.5\linewidth]{images/device-1}
		\caption{Датчик освещенности}
		\label{fig:device-1}
	\end{figure}
	
	% TODO: \usepackage{graphicx} required
	\begin{figure}[h!]
		\centering
		\includegraphics[width=0.5\linewidth]{images/device-2}
		\caption{Датчик влажности}
		\label{fig:device-2}
	\end{figure}
	
	% TODO: \usepackage{graphicx} required
	\begin{figure}[h!]
		\centering
		\includegraphics[width=0.5\linewidth]{images/device-3}
		\caption{Преобразователь 1--Wire~—~Modbus RTU}
		\label{fig:device-3}
	\end{figure}
\end{problem}


\newpage
\subsection{Протоколы работы с устройствами}

\begin{problem}
	Опишите принцип работы, преимущества и недостатки, сферу применения следующих
	четырех технологий:
	\begin{enumerate}
		\item Modbus RTU;
		\item  1-Wire;
		\item  I${}^2$C (IIC, англ. Inter-Integrated Circuit);
		\item  CAN.
	\end{enumerate}
	\nonum
	\subsubsection*{Modbus RTU}
	
	Modbus --- коммуникационный протокол, основан на архитектуре ведущий-ведомый (master-slave). Использует для передачи данных интерфейсы RS-485, RS-422, RS-232, а также Ethernet сети TCP/IP (протокол Modbus TCP).
	
	Сообщение Modbus RTU состоит из адреса устройства SlaveID, кода функции, специальных данных в зависимости от кода функции и CRC контрольной суммы.
	
	SlaveID – это адрес устройства, может принимать значение от 0 до 247, адреса с 248 до 255 зарезервированы.
	
	\paragraph*{Достоинства стандарта}
	Основные достоинства стандарта — открытость и массовость. Промышленностью сейчас (2014 г.) выпускается очень много типов и моделей датчиков, исполнительных устройств, модулей обработки и нормализации сигналов и др. Практически все промышленные системы контроля и управления имеют программные драйверы для работы с MODBUS-сетями.
	
	\paragraph*{Недостатки стандарта}
	Стандарт в своей основе был разработан в 1979 году с учётом потребностей и вычислительных возможностей того времени, и многие актуальные для современных промышленных сетей вопросы не были учтены. Необходимо отметить, что отсутствие перечисленных возможностей является следствием простоты протокола, которая облегчает его изучение и ускоряет внедрение.
	
	\begin{itemize}
		\item Стандарт специфицирует метод передачи только двух типов данных. 
		\item Стандарт не регламентирует начальную инициализацию системы.
		\item Не предусмотрена передача сообщений по инициативе подчинённого устройства (прерываний). 
		\item Длина запроса ограничена, а данные могут быть запрошены только из последовательно расположенных регистров. 
		\item Не предусмотрен способ, с помощью которого подчинённое устройство могло бы обнаружить потерю связи с ведущим.
	\end{itemize}
	
	
	
	\subsubsection*{1-Wire}
	1-Wire c (англ. --- <<один провод>>) --- двунаправленная шина связи для устройств с низкоскоростной передачей данных (обычно 15,4 Кбит/с, максимум 125 Кбит/с в режиме overdrive), в которой данные передаются по цепи питания (то есть всего используются два провода — один общий (GND), а второй для питания и данных; в некоторых случаях используют и отдельный провод питания). Разработана корпорацией Dallas Semiconductor.
	
	Соответственно, топология такой сети --- общая шина. Сеть устройств 1-Wire со связанным основным устройством названа «MicroLan», это также торговая марка Dallas Semiconductor.
	
	Обычно используется для того, чтобы связываться с недорогими простыми устройствами, такими, как, например, цифровые термометры и измерители параметров внешней среды.
	
	\paragraph*{Достоинства}
	
	\begin{itemize}
		\item Для связи с устройством требуется лишь два провода: на данные и заземление. Интегральная схема включает конденсатор ёмкостью 800 пФ для питания от линии данных (так называемое паразитное питание).
		\item Большое расстояние передачи. Расстояние достигает 300 м при соблюдении ряда условий:
		\begin{itemize}
			\item применение кабеля типа «витая пара»;
			\item использование специального драйвера сети (активная подтяжка с учётом тока в линии);
			\item использование топологии «общая шина» с единым стволом (не свободная топология);
		\end{itemize}
		
		\item Изменяемость конфигурации любой сети 1-Wire в процессе её работы.
	\end{itemize}
	
	\paragraph*{Недостатки}
	\begin{itemize}
		\item Низкая скорость передачи данных;
		\item Проводной интерфейс. Хотя в конкретном случае это может быть и достоинством.
	\end{itemize}
	
	
	\subsection*{I${}^2$C }
	I${}^2$C (IIC), (Inter-Integrated Circuit)  --- последовательная асимметричная шина для связи между интегральными схемами внутри электронных приборов. Использует две двунаправленные линии связи (SDA и SCL), применяется для соединения низкоскоростных периферийных компонентов с процессорами и микроконтроллерами (например, на материнских платах, во встраиваемых системах, в мобильных телефонах).
	
	\paragraph{Принцип работы}
	I${}^2$C использует две двунаправленные линии, подтянутые к напряжению питания и управляемые через открытый коллектор или открытый сток — последовательная линия данных (SDA, англ. Serial DAta) и последовательная линия тактирования (SCL, англ. Serial CLock). Стандартные напряжения +5 В или +3,3 В, однако допускаются и другие.
	
	Классическая адресация включает 7-битное адресное пространство с 16 зарезервированными адресами. Это означает, что разработчикам доступно до 112 свободных адресов для подключения периферии на одну шину.
	
	Основной режим работы — 100 кбит/с; 10 кбит/с в режиме работы с пониженной скоростью. Также немаловажно, что стандарт допускает приостановку тактирования для работы с медленными устройствами.
	
	\paragraph*{Преимущества}
	\begin{enumerate}
		\item необходим всего один микроконтроллер для управления набором устройств;
		\item используется всего два проводника для подключения многих устройств;
		\item возможна одновременная работа нескольких ведущих (master) устройств, подключенных к одной шине I${}^2$C;
		\item стандарт предусматривает «горячее» подключение и отключение устройств в процессе работы системы;
		\item встроенный в микросхемы фильтр подавляет всплески, обеспечивая целостность данных.
	\end{enumerate}
	
	\paragraph*{Недостатки}
	\begin{enumerate}
		\item ограничение на ёмкость линии — 400 пФ;
		\item несмотря на простоту протокола, программирование контроллера I${}^2$C затруднено из-за изобилия возможных нештатных ситуаций на шине. По этой причине большинство систем используют I${}^2$C c единственным ведущим (Master) устройством, и распространённые драйверы поддерживают только монопольный режим обмена по I${}^2$C;
		\item трудность локализации неисправности, если одно из подключенных устройств ошибочно устанавливает на шине состояние низкого уровня.
	\end{enumerate}
	\subsubsection*{CAN}
	CAN (англ. Controller Area Network -- сеть контроллеров) --- стандарт промышленной сети, ориентированный, прежде всего, на объединение в единую сеть различных исполнительных устройств и датчиков. Режим передачи — последовательный, широковещательный, пакетный.
	
	CAN разработан компанией Robert Bosch GmbH в середине 1980-х и в настоящее время широко распространён в промышленной автоматизации, технологиях домашней автоматизации («умного дома»), автомобильной промышленности и многих других областях. Стандарт для автомобильной автоматики.
	
	\paragraph*{Описание стандарта}
	Непосредственно стандарт CAN компании Bosch определяет передачу в отрыве от физического уровня — он может быть каким угодно, например, радиоканалом или оптоволокном. Но на практике под CAN-сетью обычно подразумевается сеть топологии «шина» с физическим уровнем в виде дифференциальной пары, определённым в стандарте ISO 11898. Передача ведётся кадрами, которые принимаются всеми узлами сети. Для доступа к шине выпускаются специализированные микросхемы — драйверы CAN-шины.
	
	\paragraph*{Преимущества}
	\begin{enumerate}
		\item Возможность работы в режиме жёсткого реального времени.
		\item Простота реализации и минимальные затраты на использование.
		\item Высокая устойчивость к помехам.
		\item Арбитраж доступа к сети без потерь пропускной способности.
		\item Надёжный контроль ошибок передачи и приёма.
		\item Широкий диапазон скоростей работы.
		\item Большое распространение технологии, наличие широкого ассортимента продуктов от различных поставщиков.
	\end{enumerate}

	\paragraph*{Недостатки}
	\begin{enumerate}
		\item Небольшое количество данных, которое можно передать в одном пакете (до 8 байт).
		\item Большой размер служебных данных в пакете (по отношению к полезным данным).
		\item Отсутствие единого общепринятого стандарта на протокол высокого уровня, однако это --- и достоинство. Стандарт сети предоставляет широкие возможности для практически безошибочной передачи данных между узлами, оставляя разработчику возможность вложить в этот стандарт всё, что туда сможет поместиться. 
		
		В этом отношении CAN подобен простому электрическому проводу. Туда можно «затолкать» любой поток информации, который сможет выдержать пропускная способность шины.
		
	\end{enumerate}
	
\end{problem}


\newpage

\section{Дополнительные задания к работе №5}

\subsection{Оборудование, необходимое \\для реализации проекта}
\begin{problem}
	Опишите оборудование (датчики и актуаторы), необходимое для сборки
	аппаратных компонентов системы в вашем проекте, а также целесообразность выбора
	именно такого оборудования (например, на основе температурных условий его
	эксплуатации, точности, диапазона измерений, размера, веса и т.д.).
	
	Если предполагается использовать программный эмулятор физического устройства,
	опишите набор оборудования, поведение которого вы собираетесь эмулировать.
	
	

	\nonum  
	Приведем список оборудование, необходимого для реализации проекта по управлению освещением в системе Умного дома.
	
	\subsubsection*{Датчик движения}
	
	
	\begin{enumerate}
		\item \textbf{Название датчика/устройства:} датчик движения в составе WB-MSW v.3: \href{https://wirenboard.com/ru/product/wb-msw-v3}{ссылка на источник}.
		
		\item \textbf{Тип измерения:} цифровой
		
		\item  \textbf{Измеряемые параметры и диапазон измерения:}  Движение на расстояний до 8 метров, 120 градусов
		
		\item  \textbf{Точность:} $\pm10 \%$	
		\item  \textbf{Напряжение питания:} 9 В~--~28 В постоянного тока
		
		\item  \textbf{Использующийся протокол передачи данных:} Modbus RTU
		
		\item  \textbf{Интерфейс управления (шина):} RS-485
		
		\item  \textbf{Описание входов и выходов, схема подключения:} см. рис. \ref{fig:device-4}.
	\end{enumerate}
	
	
	\subsubsection*{Датчик шума}
	
	
	\begin{enumerate}
		\item \textbf{Название датчика/устройства:}датчик шума в составе WB-MSW v.3:  \href{https://wirenboard.com/ru/product/wb-msw-v3/}{ссылка на источник}.
		
		
		\item \textbf{Тип измерения:} цифровой
		
		\item  \textbf{Измеряемые параметры и диапазон измерения:}  Уровень шума (звуковое давление), диапазон: 38 --- 105 дБ
		
		\item  \textbf{Точность:} $\pm1 дБ$	
		\item  \textbf{Напряжение питания:} 9 В~--~28 В постоянного тока
		
		\item  \textbf{Использующийся протокол передачи данных:} Modbus RTU
		
		\item  \textbf{Интерфейс управления (шина):} RS-485
		
	\end{enumerate}
	
	
	\subsubsection*{Датчик холла на дверях}
	
	\begin{enumerate}
		\item \textbf{Название датчика/устройства:}Датчик Холла (Troyka-модуль) на основе микросхемы SS49E: \href{https://amperka.ru/product/troyka-hall-sensor}{ссылка на источник}.
		
		
		\item \textbf{Тип измерения:} аналоговый
		
		\item  \textbf{Измеряемые параметры и диапазон измерения:} Сила магнитного поля, диапазон: -100 --- 100 мТ
		
		\item  \textbf{Напряжение питания:} 5 В постоянного тока
		
		\item  \textbf{Интерфейс управления (шина):} RS-485
	\end{enumerate}
	
	\subsubsection*{Диммер светодиодных лент}
	
	\begin{enumerate}
		\item \textbf{Название датчика/устройства:}  Четырехканальный диммер WB-MRGBW-D: \href{https://wirenboard.com/ru/product/WB-MRGBW-D/}{ссылка на источник}.
		
		
		
		\item  \textbf{Измеряемые параметры и диапазон измерения:} Сила магнитного поля, диапазон: -100 --- 100 мТ
		
		\item  \textbf{Напряжение питания:} 9 В – 28 В постоянного тока
		
		\item  \textbf{Использующийся протокол передачи данных:} Modbus RTU
		
		\item  \textbf{Интерфейс управления (шина):} RS-485
		
		\item  \textbf{Описание входов и выходов, схема подключения:} см. рис. \ref{fig:device-5}.
	\end{enumerate}
	
	
	% TODO: \usepackage{graphicx} required
	\begin{figure}[htpb]
		\centering
		\includegraphics[width=0.5\linewidth]{images/device-4}
		\caption{Датчик движения}
		\label{fig:device-4}
	\end{figure}
	
	% TODO: \usepackage{graphicx} required
	\begin{figure}[htpb]
		\centering
		\includegraphics[width=0.5\linewidth]{images/device-5}
		\caption{Диммер светодиодных лент }
		\label{fig:device-5}
	\end{figure}
	
\end{problem}
	\subsection{Технологии передачи данных}
	
	\begin{problem}
		Выберите технологии передачи данных от физического устройства в сеть
		Интернет. Приведите обоснование своего выбора (например, с точки зрения скорости
		передачи данных, объемов передаваемых данных, частоте, энергоэффективности и т.д.).
		
		\nonum 
		В качестве технологий передачи данных от физического устройства в Интернет мы выбрали WiFi. Роутер WiFi есть у большинства пользователей Умного дома, что позволит сэкономить на необходимом оборудовании для установки. Также данный выбор обоснован низкими требованиями проекта. 
	\end{problem}
	
	\newpage
\section{Практическая работа №6.\\ Основы работы с протоколом MQTT. Брокераж сообщений }

\subsection{SHH-подключение}

\begin{problem}
	Подключитесь к консоли WirenBoard по протоколу SSH. Для этого используйте SSH-клиент
	PuTTy (или другой клиент).
	
	\nonum 
	
	Подключимся к консоли WirenBoard по протоколу SSH. Используем утилиту ssh. Работы будем проводить в оболочке PowerShell.
	% TODO: \usepackage{graphicx} required
	\begin{figure}[h!]
		\centering
		\includegraphics[width=0.9\linewidth]{images/ssh-powershell}
		\caption{Подключение к консоли WirenBoard по SSH}
		\label{fig:ssh-powershell}
	\end{figure}
	%
\end{problem}

	\subsection{Подписка на топик}
\begin{problem}
	При помощи улиты mosquitto\_sub подпишитесь на сообщения нескольких датчиков
	стенда, согласно варианту:
	\begin{enumerate}
		\item Датчик влажности устройства WB-MS v.2 (12)
		\item Кнопка 29
	\end{enumerate}

\nonum

При помощи улиты mosquitto\_sub подпишемся на сообщения датчика влажности устройства WB-MS v.2 (12).
% TODO: \usepackage{graphicx} required
\begin{figure}[htpb]
	\centering
	\includegraphics[width=0.9\linewidth]{images/ssh-powershell2}
	\caption{Подписка на сообщения датчика влажности}
	\label{fig:ssh-powershell2}
\end{figure}
При помощи улиты mosquitto\_sub подпишемся на сообщения кнопки 29.
% TODO: \usepackage{graphicx} required
\begin{figure}[htpb]
	\centering
	\includegraphics[width=0.9\linewidth]{images/ssh-powershell2.1}
	\caption{Подписка на сообщения кнопки 29}
	\label{fig:ssh-powershell2.1}
\end{figure}
\end{problem}	
	
	
	\subsection{Управление устройствами}
	\begin{problem}
		Включите или измените поведение устройств посредством отправки сообщение в
		соответствующий топик согласно вариантам: 
		\begin{enumerate}
			\item Включите индикатор 26
			\item Включите и измените уровень громкости звукового сигнала
		\end{enumerate}
	
	\nonum 
	
		Включим индикатор 26 посредством отправки сообщения в
	соответствующий топик.
	% TODO: \usepackage{graphicx} required
	\begin{figure}[htpb]
		\centering
		\includegraphics[width=1\linewidth]{images/ssh-powershell3.1}
		\caption{Включение индикатора 26}
		\label{fig:ssh-powershell3.1}
	\end{figure}

	Изменим уровень громкости звукового сигнала посредством отправки сообщения в
	соответствующий топик.
	
	% TODO: \usepackage{graphicx} required
	\begin{figure}[htbp]
		\centering
		\includegraphics[width=0.9\linewidth]{images/ssh-powershell3.2}
		\caption{Изменение уровня громкости}
		\label{fig:ssh-powershell3.2}
	\end{figure}
	Проверим корректность изменений с помощью web-клиента.
	% TODO: \usepackage{graphicx} required
	\begin{figure}[htbp]
		\centering
		\includegraphics[width=0.8\linewidth]{images/ssh-powershell3.3}
		\caption{Сведения в web-клиенте}
		\label{fig:ssh-powershell3}
	\end{figure}	
	
	\end{problem}
	

\subsection{Сообщения MQTT с внешнего устройства}
\begin{problem}
	Настройте MQTT-мост (т.е. пересылку всех сообщений MQTT на любой облачный MQTT
	брокер и обратно) или создайте собственный брокер MQTT.
	Обязательно верните файл конфигурации mosquito.conf контроллера к изначальному
	состоянию после выполнения работы!
	Процесс настройки приведен в документации к контроллеру WirenBoard.
	
	\nonum
	
	Настроим MQTT-мост (т.е. пересылку всех сообщений MQTT на любой облачный MQTT
	брокер и обратно) (см. рис. \ref{fig:ssh-config}).
	% TODO: \usepackage{graphicx} required
	\begin{figure}[htbp]
		\centering
		\includegraphics[width=0.6\linewidth]{images/ssh-powershell4}
		\caption{Настройка MQTT-моста}
		\label{fig:ssh-config}
	\end{figure}
	
	Наблюдаем изменение цвета RGB ленты в составе демонстрационного стенда \stend (см. рис. \ref{fig:ssh-stend}). Данные изменения можно также увидеть в web-клиенте (см. рис. \ref{fig:ssh-web-client}).
	
	% TODO: \usepackage{graphicx} required
	\begin{figure}[htbp]
		\centering
		\includegraphics[width=0.7\linewidth]{images/ssh-powershell4.2}
		\caption{Статус RGB контроллера в web-клиенте}
		\label{fig:ssh-web-client}
	\end{figure}
	
	
	% TODO: \usepackage{graphicx} required
	\begin{figure}[htbp]
		\centering
		\includegraphics[width=0.6\linewidth]{images/ssh-powershell4.1}
		\caption{Изменения на стенде}
		\label{fig:ssh-stend}
	\end{figure}
	
\end{problem}


\newpage
\section{Дополнительные задания к работе №6}
\subsection{Выбор облачной платформы}

\begin{problem}
	Рассмотрите следующие облачные платформы, их функционал и документацию и выберите
	облачную платформу, которую можно было бы использовать в вашей разрабатываемой
	системе (проекте).
	
	
	\nonum
	
	В качестве брокера сообщений и облачной платформы для них были выбраны Mosquitto и Clusterfly соответственно. Такой выбор исходит из нескольких причин:
	\begin{itemize}
		\item Данные технологии распространяются свободно и отлично подходят для учебного проекта;
		
		\item В ходе выполнения предыдущих практических работ нами уже был получен опыт использования данных технологий, что облегчит их дальнейшее использование и увеличит скорость разработки проекта.
	\end{itemize}
\end{problem}

\subsection{Взаимодействие компонентов проекта}
\begin{problem}
	
	С помощью диаграммы последовательности (UML Sequence Diagram) отобразите
	взаимодействие всех компонентов вашего проекта. 
	
	\nonum
	Ниже приведена диаграмма последовательности взаимодействия сервисов проекта в методологии UML.
	% TODO: \usepackage{graphicx} required
	\begin{figure}[htpb]
		\centering
		\includegraphics[width=0.7\linewidth]{images/sql-6}
		\caption{Диаграмма последовательности взаимодействия сервисов}
		\label{fig:sql-6}
	\end{figure}
\end{problem}

\newpage

\section{Практическая работа №7.\\ Форматы представления данных }

\subsection{Написание скриптов}
\begin{problem}
	С компьютера в аудитории или личного устройства подпишитесь на несколько
	MQTT-топиков стенда согласно вариантам.
	\begin{enumerate}
		\item Датчик CO2 устройства WB-MSW v.3 (5)
		\item Датчик шума устройства WB-MSW v.3 (5)
		\item Датчик освещенности устройства WB-MS v.2 (12)
		\item Датчик температуры устройства WB-MSW v.3 (5)
	\end{enumerate}
	\nonum Приведем листинг функции, позволяющей подписаться на предложенные MQTT-топики стенда \stend.


\lstinputlisting[language=python]{/home/denilai/Documents/repos/latex/scripts/task7-paho.py}

\end{problem}


\begin{problem}
На любом языке программирования реализуйте программу (скрипт), которая бы
каждые 5 секунд упаковывала последние полученные данные в файлы формата
JSON и XML. В одной записи должно быть 6 полей: 4 показаний датчиков, время
формирования файла, номер чемодана (последние две цифры IP-адреса).
\nonum 
Укажем структуру данных, получаемых от стенда с описанием каждого поля.

Структура данных:

\textbf{timestamp}: string (временная отметка)

\textbf{group}: int (номер чемодана)

\textbf{motion}: int (показания датчика движения)

\textbf{temperature}: float (показания датчика температуры)

\textbf{sound}: float (показания датчика шума)

\textbf{illuminace}: float (показания датчика освещения)


Приведем листинг функции, позволяющей упаковывать полученные данные в файлы формата JSON и XML.  
\lstinputlisting[language=python]{/home/denilai/Documents/repos/latex/scripts/task7-reparse.py}
\end{problem}

\begin{problem}
На любом языке программирования реализуйте программу-парсер, которая бы
выводила в консоль данные, полученные из сгенерированных в п.2 файлов.

\nonum Приведем листинг функции, позволяющей распаковывать, полученные в задании 2, файлы формата JSON и XML и выводить данные в консоль.  
\newpage
\lstinputlisting[language=python]{/home/denilai/Documents/repos/latex/scripts/task7-parse.py}
\end{problem}

\textbf{Краткое описание сторонних библиотек:}
Для работы с xml использовалась библиотека \textit{xmltodict}. Она реализует создание файлов в формате xml из словарей с данными и наоборот

\subsection{Запуск скриптов}
Для того, чтобы проверить работоспособность и корректность написанных скриптов, попробуем создать файл, содержащие данные, аналогичные тем, что будут возвращать датчики, входящие в состав \stend, запаковать их с помощью скрипта \textit{task7-reparse.py} в JSON и XML, затем снова распаковать их с помощью скрипта \textit{task7-parse.py} вывести результат в консоль.

\newpage
% TODO: \usepackage{graphicx} required
\begin{figure}[htpb]
	\centering
	\includegraphics[width=0.7\linewidth]{images/data.xml-cat}
	\caption{Упаковка данных в XML}
	\label{fig:data}
\end{figure}

% TODO: \usepackage{graphicx} required
\begin{figure}[h!]
	\centering
	\includegraphics[width=0.7\linewidth]{images/run-reparse}
	\caption{Распаковка данных, полученных с датчиков}
	\label{fig:run-reparse}
\end{figure}

\section{Дополнительные задания к работе №7}
\setcounter{problem}{0}
\subsection{Описание структуры данных}
\paragraph{ Написание скриптов}
\begin{problem}
Приведите структуру данных, получаемых от физического устройства
разрабатываемой системы (или mock-объекта, его заменяющего), с указанием типов
данных и описанием каждого поля. Пример структуры данных, получаемых от
физического объекта:

\nonum
Опишем структуру данных, получаемую от физического устройства разрабатываемой нами системы управления освещением в инфраструктуре Умного дома:
\textbf{timestamp}: string
\textbf{motion}: int
\textbf{noise}: int
\textbf{door\_open}: bool
\end{problem} 

\begin{problem}
	На любом языке программирования реализуйте программу (скрипт), которая бы
	генерировала JSON-файл на основе данных из предыдущего пункта задания. Для
	демонстрации работы скрипта достаточно считать вводимые пользователем в
	консоли показатели.
	
	\nonum Реализуем скрипт, который бы генерировал JSON-файл, включающий поля, указанные в предыдущем задании. Приведем листинг его листинг. Скрип генерирует случайные целочисленные значения в диапазоне от 20 до 800, а также случайные булевы значения.
\lstinputlisting[language=python]{/home/denilai/Documents/repos/latex/scripts/task7-dop-1.py}
\end{problem}

\begin{problem}
	На любом языке программирования реализуйте программу-парсер, которая бы
	выводила в консоль данные, полученные из сгенерированного в п.2 файла.
	\nonum Реализуем скрипт-парсер, который бы выводил в консоль данные, полученные из сгенерированного в предыдущем задании JSON-файла. 
	\lstinputlisting[language=python]{/home/denilai/Documents/repos/latex/scripts/task7-dop-parse.py}
\end{problem}
	
	\paragraph{Запуск скриптов}
	
	Проверим работоспособность скриптов, выполнив следующие команды
	
\subsection{Реализация программного эмулятора}
\begin{problem}
	Соберите физическое устройство или реализуйте на любом языке программирования его
	программный эмулятор. Эмулятор должен генерировать поток данных и выводить их в
	консоли.
	
	\nonum Опишем программу-генератор, эмитирующий работу физического устройства, путем генерации значений, идентичный по формату тем, которые будут получены от датчиков, включенных в состав разрабатываемого нами устройства. 
	
	\lstinputlisting[language=python]{/home/denilai/Documents/repos/latex/scripts/task7-dop-1.py}
	
	Приведем результат выполнения данной программы. См. рис. \ref{fig:dop-res-1}.
	
	% TODO: \usepackage{graphicx} required
	\begin{figure}[htpb]
		\centering
		\includegraphics[width=0.7\linewidth]{images/dop-res-1}
		\caption{Эмуляция потока данных}
		\label{fig:dop-res-1}
	\end{figure}
\end{problem}

\newpage
\section{Практическая работа № 8. – Визуализация данных в Интернете вещей}
\subsection{Визуализация данных}
После сбора показаний с датчиков и сохранения данных в системах интернета вещей
зачастую предусмотрена возможность визуализации для пользователей первичных данных
или результата их агрегации и анализа

\begin{problem}
Подпишитесь на несколько MQTT топиков стенда согласно вариантам c компьютера
в аудитории или личного устройства и собирайте данные с датчиков в течение 10
или более минут.
\begin{enumerate}
	\item Датчик CO2 устройства WB-MSW v.3 (5)
	\item Датчик освещенности устройства WB-MS v.2 (12)
	\item Напряжение на любом устройстве стенда
\end{enumerate}

\nonum

\end{problem}

\begin{problem}
	Напишите скрипты, позволяющие визуализировать полученные статистические
	данные в виде
	\begin{itemize}
		\item Столбиковой диаграммы (гистограммы) (например, частоты показаний
		датчика)
		\item Линейного графика (например, показаний по времени)
		\item Круговой диаграммы (например, распределения показаний по времени)
	\end{itemize}
Необходимо реализовать визуализацию данных всех трех перечисленных типов (т.е.
для каждого датчика необходимо выбрать тип визуализации на свое усмотрение и
не повторяться в типах визуализации в рамках одного варианта). 
\end{problem}

\newpage
\section{Дополнительное задание\\практической работы №8}
\subsection{Построение взаимодействия между MQTT-брокером и программно-аппаратным комплексом}
\begin{problem}
	Поднимите на физическом устройстве (или на устройстве, где запущен его программный
	эмулятор) MQTT-брокер. Показания с датчиков должны публиковаться в соответствующие
	им топики. 
	
	Подпишитесь с другого устройства (компьютера в аудитории или личного устройства) на
	топики физического устройства. Полученные от MQTT-брокера данные сохраняйте в
	локальную базу данных.
	
	В отчете опишите процесс настройки MQTT-брокера (снабжая текстовое описание
	скриншотами), структуру топиков, процесс подключения другого устройства к MQTT-брокеру и результат получения и сохранения данных от физического устройства. 
	\nonum
	В качестве MQTT брокера был выбран mosquitto. Для его установки выполняется команда:
	\begin{lstlisting}
		sudo apt-get install mosquitto
	\end{lstlisting}
	Далее производится настройка брокера. Для этого открывается файл настроек расположенный в /etc/mosquitto/mosquitto.conf. Цель настройки подключить локальный MQTT брокер к облачному брокеру Clusterfly, чтобы можно было получить доступ к данным за пределами локальной сети. 
	Приведем содержание конфигурационного файла MQTT-брокера:
	\lstinputlisting{\pathToScriptsFolder/mosquitto.conf}
	
	Для отправки данных в локальный брокер написана программа на Python~3. Она будет эмулировать датчики, используя генератор псевдо-случайных чисел.
	
	Данные, возвращаемые виртуальными датчиками будет посылаться локальному брокеру используя библиотеку \texttt{paho-mqtt}.
	\lstinputlisting{\pathToScriptsFolder/task8-publish.py}
	
	Для подключения клиентов также была написана программа на Python~3. Она подключается к MQTT брокеру с помощью библиотеки \texttt{paho-mqtt}. 
	\lstinputlisting{\pathToScriptsFolder/task8-receive.py}
	
	Далее получаются все сообщения и периодически данные записываются в локальную базу данных. Для подключения нового устройства достаточно установить на нем Python~3 и соответствующие библиотеки.
	
	Приведем результаты работы программ \texttt{task8-publish.py} и \texttt{task8-receive.py}, а также результат наполнения базы данных телеметрией с виртуальных датчиков. См. рис. 
	\newpage
	% TODO: \usepackage{graphicx} required
	\begin{figure}[htpb]
		\centering
		\includegraphics[width=0.8\linewidth]{images/task8-dop-publish}
		\caption{Публикация данных}
		\label{fig:task8-dop-publish}
	\end{figure}

	% TODO: \usepackage{graphicx} required
\begin{figure}[htpb]
	\centering
	\includegraphics[width=0.8\linewidth]{images/task8-dop-receive}
	\caption{Подключение клиентов. Запись телеметрии. Клиент 2}
	\label{fig:task8-dop-receive}
\end{figure}


	% TODO: \usepackage{graphicx} required
\begin{figure}[htpb]
	\centering
	\includegraphics[width=0.8\linewidth]{images/task8-dop-receive-2nd-device}
	\caption{Подключение клиентов. Запись телеметрии. Клиент 2}
	\label{fig:task8-dop-receive-2}
\end{figure}


	% TODO: \usepackage{graphicx} required
\begin{figure}[htpb]
	\centering
	\includegraphics[width=0.8\linewidth]{images/task8-dop-db}
	\caption{Запись телеметрии с датчиков в БД}
	\label{fig:task8-dop-db}
\end{figure}

	
\end{problem}
	

\newpage

\anonsection{Вывод}
В ходе практических работ 5-8 нами был проведен обзор измерительных и исполнительных устройств стенда \stend, изучены протоколы работы с устройствами, рассмотрена на практике работа с брокером сообщений, произведена его настройка для работы с несколькими устройствами, написаны скрипты для отправки и получения телеметрических данных виртуальных датчиков, написан эмулятор, который в дальнейшем был использован для имитации работы физического устройства, произведена работа по визуализации данных, полученных с датчиков, реализован механизм получения и сохранения данных, передаваемых датчиками, и их сохранении в локальной базе данных. 

Полученные на практике знания позволили нам спроектировать программно-аппаратный комплекс, работающий в составе системы Умного дома, позволяющий динамически изменять режим освещения в зависимости от времени дня, заполненности помещения, а также имеющий мультимедийные возможности.
\newpage

\anonsection{Список использованных источников}
\begin{enumerate}
	\item Документация на демонстрационный стенд \stend: https://wirenboard.com/wiki/Wb-demo-kit\_v.2
	\item Веб-интерфейс WirenBoard: https://wirenboard.com/wiki/Wiren\_Board\_Web\_Interface
	\item Утилита для извлечения исторических данных из внутренней базы данных:
	https://wirenboard.com/wiki/Wb-mqtt-db-cli
	\item Протокол MQTT: https://en.wikipedia.org/wiki/MQTT
	\item Описание улиты mosquito\_sub: http://mosquitto.org/man/mosquitto\_sub-1.html
	\item Описание улиты mosquito\_pub: https://mosquitto.org/man/mosquitto\_pub-1.html
	\item Описание протокола MQTT: https://ipc2u.ru/articles/prostye-resheniya/chto-takoemqtt/, https://habr.com/ru/post/463669/
	\item Подключение к контроллеру по SHH: https://wirenboard.com/wiki/SSH
	\item Визуализация: https://tableau.pro/m11
	\item Графики: https://tableau.pro/m16
	\item Гистограммы: https://tableau.pro/m19
	\item Круговые диаграммы: https://tableau.pro/m23
	\item JSON: https://ru.wikipedia.org/wiki/JSON, https://habr.com/ru/post/554274/
	\item XML: https://ru.wikipedia.org/wiki/XML, https://code.makery.ch/ru/library/javafxtutorial/part5/ https://habr.com/ru/post/524288/
	\item Paho MQTT: https://www.emqx.com/en/blog/how-to-use-mqtt-in-python
\end{enumerate}
\end{document}




