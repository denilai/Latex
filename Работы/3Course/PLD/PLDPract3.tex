\documentclass[a4paper,14pt]{extarticle}

% Путь до папки с общими шаблонами
\newcommand{\pathToCommonFolder}{/home/denilai/Documents/repos/latex/Common}
% Название работы в титуле
\newcommand{\workname}{Отчет по лабораторной работе №3}
% Название дисциплины в титуле
\newcommand{\discipline}{Проектирование и разработка систем на базе ПЛИС}
% Название кафедры в титуле
\newcommand{\kafedra}{Кафедра Вычислительной техники}
% Тема работы в титуле
\newcommand{\theme}{Проектирование цифрового узла анализатора последовательности и
	его верификация средствами САПР Xilinx ISE 14.х.}
% Должность преподавателя в титуле
\newcommand{\rang}{ассистент}
\newcommand{\signature}{\pathToCommonFolder/denisov-signature}

% ФИО студента в титуле
\newcommand{\studentfio}{К.~Ю.~Денисов}
% ФИО преподавателя в титуле
\newcommand{\teacherfio}{А.~С.~Боронников}


\usepackage{tabularx}


\usepackage{booktabs}
\newcolumntype{b}{X}
\newcolumntype{s}{>{\hsize=.5\hsize}X}
\newcommand{\heading}[1]{\multicolumn{1}{c}{#1}}

% установка размера шрифта для всего документа
%\fontsize{20pt}{18pt}\selectfont
\usepackage{extsizes} % Возможность сделать 14-й шрифт

% Вставка заготовки преамбулы
\input{\pathToCommonFolder/ruspreamble}

\author{Кирилл Денисов}
\title{Лабораторная работа №2}
\date{\today}

%если не нужна тема работы в отчете, то указать в скобках что-либо, иначе оаставить пустым
\renewcommand{\withouttheme}{}
%если нужна дата представления отчета, то указать в скобках что-либо
%\renewcommand{\withoutsubmissiondate}{1}

% установка полуторного интервала
% \usepackage{setspace}  
% \onehalfspacing

% использовать Times New Roman
\renewcommand{\rmdefault}{ftm}


\begin{document}
	\thispagestyle{empty}
	% Вставка первого титульного листа
	\input{\pathToCommonFolder/titul-with-signature}
	\newpage
	%\tableofcontents
	\newpage
	%\listoftables
\section*{Постановка задачи}	
%\subsection* {Постановка задачи}

Требуется разработать цифровой узел на основе отладочной платы Digilent Nexys 4,
представляющий собой анализатор фиксированной последовательности логических
сигналов. Узел должен обеспечивать индикацию ожидаемых и вводимых элементов
последовательности посредством входящих в состав отладочной платы семисегментных
индикаторов согласно данному заданию.

Узел должен быть реализован в виде синтезируемой модели на языке Verilog HDL.

Интерфейс верхнего уровня иерархии модели должен состоять из набора сигналов,
представленного на рис. 1.

Автомат должен иметь интерфейс, представленный на рис \ref{fig:fsmexample}.

% TODO: \usepackage{graphicx} required
\begin{figure}[h!]
	\centering
	\includegraphics[width=0.7\linewidth]{images/interface-pract3}
	\caption{Интерфейс модели цифрового узла}
	\label{fig:interface-pract3}
\end{figure}


Разрабатываемое устройство является синхронным цифровым узлом,
срабатывающим по восходящим фронтам синхросигнала CLK. Исключение составляет
асинхронный вход сброса CPU\_RSTn, принудительно устанавливающий все регистры
узла в исходное состояние. Подача сигнала сброса на вход узла осуществляется
посредством соответствующей кнопки (CPU\_RSTn) отладочной платы.

Распознавание элементов последовательности осуществляется четверками, т.е.
необходимо обеспечить последовательную загрузку в узел элементов Y c номерами 0-3, 4-
7, 8-B, C-F для успешного распознавания последовательности. При осуществлении ввода
значения, не соответствующего текущему ожидаемому элементу последовательности,
необходимо повторить ввод всей четверки элементов заново




Индикация работы узла посредством двух блоков семисегментных индикаторов для
каждого варианта осуществляется аналогично примеру, представленному на рис. 3 и
подчиняется следующим правилам:
\begin{enumerate}
	\item Левый блок семисегментных индикаторов отображает ожидаемый (младший
	разряд) и введенные (три старших разряда) элементы последовательности в объеме
	распознаваемой четверки.
	\item  Правый блок семисегментных индикаторов отображает предысторию ввода
	комбинаций последовательности. Последняя введенная комбинация отображается в
	младшем разряде блока.
	\item  Не задействованные в текущий момент времени семисегментные индикаторы на
	обоих блоках должны находится в выключенном состоянии.
	\item Обновление отображаемых значений на обоих блоках семисегментных
	индикаторов рекомендуется выполнять с частотой от 60Гц до 200Гц.
\end{enumerate}


\section*{Результат работы}

Реализуем устройство, являющегося синхронным цифровым узлом. Его работу организуем по восходящему фронту синхросигнала, асинхронный сброс --- по нисходящему фронту сигнала CPU\_RSTn. 

\subsection*{Моделирование цифрового устройства}

Приведем таблицу состояний устройства (см. Таблицу \ref{tab:states}). Текущее состояние цифрового устройства зависит от последнего введенного пользователем с помощью движковых переключателей элемента последовательности. 

\begin{table}[htbp]
	\centering
	\caption{Состояния цифрового устройства}
	\begin{tabular}{|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|}
		\hline
		Состояние & 16& 15&	14	&13	&12&11&	10&	9&	8&	7&	6&	5&	4&	3&	2&	1&	0\\ \hline\hline
		Значение & 0 & 4 & 4 & 8 & 3 & 0 & 7 & 2 & 2 & D & 7 & C & 5 & 2 & A & C&-- \\ \hline\hline
		Разряд & F & E & D & C & B & A & 9 & 8 & 7 & 6 & 5 & 4 & 3 & 2 & 1 & 0 &--\\ \hline
	\end{tabular}

	\label{tab:states}
\end{table}

Приведем граф состояний цифрового устройства (см. Рисунок~\ref{fig:state-graph-pract3}). Переход в следующее состояние происходит только в случае ввода верного элемента последовательности. При неправильном вводе цифровое устройство переходит в ближайшее пройденное состояние, номер которого кратен 4. Номер состояния, в которое перейдет устройство в случае некорректного ввода можно вычислить по формуле 
\[S_{i+1}=(S_i \div 4) \cdot 4\]

% TODO: \usepackage{graphicx} required
\begin{figure}[h!]
	\centering
	\includegraphics[width=0.7\linewidth]{images/state-graph-pract3}
	\caption{Граф состояний}
	\label{fig:state-graph-pract3}
\end{figure}

%\newpage
Приведем блок схему работы устройства (см. Рисунок~\ref{fig:algorithm-pract3}). Значение Х представляет
собой номер элемента цифровой последовательности, ввод значения которого (Y)
ожидается. Значения Y каждого элемента цифровой последовательности определяются
вариантом задания.

% TODO: \usepackage{graphicx} required
\begin{figure}[h!]
	\centering
	\includegraphics[width=0.68\linewidth]{images/algorithm-pract3}
	\caption{Алгоритм распознавания последовательности}
	\label{fig:algorithm-pract3}
\end{figure}

Приведем структурную схему синхронного цифрового узла (см. Рисунок~\ref{fig:unit-pract3}).

% TODO: \usepackage{graphicx} required
\begin{figure}[h!]
	\centering
	\includegraphics[width=0.8\linewidth]{images/unit-pract3}
	\caption{Структурная схема узла}
	\label{fig:unit-pract3}
\end{figure}


\subsection*{Описание принципа работы}

Опишем главный алгоритм работы цифрового устройства --- контроль ввода шестнадцатеричных чисел с возможностью повторного задания последовательности.

Данный алгоритм описан в файле \texttt{seqAuto.v}. Его содержание приведено в Листинге \ref{lst:seq-auto}.

Сначала производим первоначальную инициализацию переменных, затем, если есть необходимость обновить изображение на дисплее (переменная \texttt{updateDisplay}), начинаем анализировать текущее состояние дисплея и пользовательский ввод. 

Если мы находимся в состоянии, номер которого кратен четырем, то отображаем только левый разряд на левом дисплее. Выводим на это место значение соответствующее значение функции, а в остальные 3 разряда левого дисплея выводим нули.

Если же мы находимся в каком--то другом состоянии, то следует перезаписать все разряды на левом дисплее на один разряд влево, записать в освободившийся разряд записываем очередное значение вектор--функции. 

В конце устанавливаем переменную \texttt{updateDisplay} в нуль. 

Если пользователь подал сигнал на загрузку числа, произведем следующие действия:

Перезапишем все разряды на правом дисплее на один разряд влево, в освободившийся разряд запишем заданное пользователем число. 

Осуществим проверку введенного числа --- сравним его с соответствующим значением вектор--функции. Если пользователь произвел верный ввод, инструментируем переменную состояния автомата (переведем его в следующее состояние). В случае ввода неправильного числа возвращаемся в ближайшее пройденное состояние, номер которого кратен 4. 

В конце устанавливаем переменную \texttt{updateDisplay} в единицу.

\subsection*{Листинг файлов}
Приведем содержание файла seqAuto.v, реализующего главный алгоритм управления цифровым устройством, который был описан в предыдущей секции (см. Листинг \ref{lst:seq-auto}).

\lstinputlisting[caption=Описание главного алгоритма,label=lst:seq-auto]{\pathToScriptsFolder/pract-3/seqAuto.v}

Приведем содержание файла buttonFilter.v, описывающего работу фильтра дребезга, используемого в данной работе для фильтрации цифрового сигнала, приходящего с кнопок ввода (см. Листинг \ref{lst:filter}).


\lstinputlisting[caption=Описание фильтра дребезга,label=lst:filter]{\pathToScriptsFolder/pract-3/buttonFilter.v}

Приведем содержание файла freq\_div.v, описывающего работу делителя частоты, применяемого в данном проекте для снижения выходных характеристик частотного генератора для подбора оптимального режима работы с семисегментными индикаторами (см. Листинг \ref{lst:freq}).

\lstinputlisting[caption=Описание делителя частоты,label=lst:freq]{\pathToScriptsFolder/pract-3/freq_div.v}

Приведем содержание файла NexysDisplay.v, описывающего работу с семисегментыми индикаторами (см. Листинг \ref{lst:n-display}).

\lstinputlisting[caption=Описание модуля работы с семисегментыми индикаторами алгоритма,label=lst:n-display]{\pathToScriptsFolder/pract-3/NexysDisplay.v}

Приведем содержание файла outFunc.v, описывающего представление бинарной вектор--функции, значения которой сравниваются с пользовательским вводом (см. Листинг \ref{lst:func}).

\lstinputlisting[caption=Описание вектор--функции,label=lst:func]{\pathToScriptsFolder/pract-3/outFunc.v}


Приведем содержание файла SevenSegDec.v, описывающего работу сигнального дешифратора для работы с семисегментыми индикаторами  (см. Листинг \ref{lst:decode}).

\lstinputlisting[caption=Описание сигнального дешифратора,label=lst:decode]{\pathToScriptsFolder/pract-3/SevenSegDec.v}


Приведем содержание файла top.v, описывающего работу модуля верхнего уровня, объединяющего все файлы и организующего работу с устройством  (см. Листинг \ref{lst:top}).

\lstinputlisting[caption=Описание модуля верхнего уровня,label=lst:top]{\pathToScriptsFolder/pract-3/top.v}

\subsection*{Эмуляция работы цифрового устройства}

Произведем тестирование работы спроектированного цифрового устройства средствами средствами САПР Xilinx ISE 14. 

% TODO: \usepackage{graphicx} required
\begin{figure}[htpb]
	\centering
	\includegraphics[width=1\linewidth]{images/pract-3/page-1}
	\caption{Эмуляция работы. Часть 1}
	\label{fig:page-1}
\end{figure}
% TODO: \usepackage{graphicx} required
\begin{figure}[htpb]
	\centering
	\includegraphics[width=1\linewidth]{images/pract-3/page-2}
	\caption{Эмуляция работы. Часть 2}
	\label{fig:page-2}
\end{figure}
% TODO: \usepackage{graphicx} required
\begin{figure}[htpb]
	\centering
	\includegraphics[width=1\linewidth]{images/pract-3/page-3}
	\caption{Эмуляция работы. Часть 3}
	\label{fig:page-3}
\end{figure}
% TODO: \usepackage{graphicx} required
\begin{figure}[htpb]
	\centering
	\includegraphics[width=1\linewidth]{images/pract-3/page-4}
	\caption{Эмуляция работы. Часть 4}
	\label{fig:page-4}
\end{figure}
% TODO: \usepackage{graphicx} required
\begin{figure}[htpb]
	\centering
	\includegraphics[width=1\linewidth]{images/pract-3/page-5}
	\caption{Эмуляция работы. Часть 5}
	\label{fig:page-5}
\end{figure}
% TODO: \usepackage{graphicx} required
\begin{figure}[htpb]
	\centering
	\includegraphics[width=1\linewidth]{images/pract-3/page-6}
	\caption{Эмуляция работы. Часть 6}
	\label{fig:page-6}
\end{figure}

 
\clearpage
{Вывод: }
В ходе данной практической работы нами были получены общие навыки работы с программным обеспечением Xilinx ISE Design Suite, изучены основы языка Verilog.

С помощью полученных знаний был спроектирован и разработан цифровой узел на основе отладочной платы Digilent Nexys 4, представляющий собой анализатор фиксированной последовательности логических
сигналов. 
\end{document}
